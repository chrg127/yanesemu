#include "screen.hpp"

// refer to http://wiki.nesdev.com/w/index.php/PPU_palettes for details on these palettes.
static u32 pal2C02[] = {
    0x545454, 0x001E74, 0x081090, 0x300088,
    0x440064, 0x5C0030, 0x540400, 0x3C1800,
    0x202A00, 0x083A00, 0x004000, 0x003C00,
    0x00323C, 0x000000, 0x000000, 0x000000,

    0x989698, 0x084CC4, 0x3032EC, 0x5C1EE4,
    0x8814B0, 0xA01464, 0x982220, 0x783C00,
    0x545A00, 0x287200, 0x087C00, 0x007628,
    0x006678, 0x000000, 0x000000, 0x000000,

    0xECEEEC, 0x4C9AEC, 0x787CEC, 0xB062EC,
    0xE454EC, 0xEC58B4, 0xEC6A64, 0xD48820,
    0xA0AA00, 0x74C400, 0x4CD020, 0x38CC6C,
    0x38B4CC, 0x3C3C3C, 0x000000, 0x000000,

    0xECEEEC, 0xA8CCEC, 0xBCBCEC, 0xD4B2EC,
    0xECAEEC, 0xECAED4, 0xECB4B0, 0xE4C490,
    0xCCD278, 0xB4DE78, 0xA8E290, 0x98E2B4,
    0xA0D6E4, 0xA0A2A0, 0x000000, 0x000000,
};

static u32 pal2C03[] = {
    0x6D6D6D, 0x002491, 0x0000DA, 0x6D48DA,
    0x91006D, 0xB6006D, 0xB62400, 0x914800,
    0x6D4800, 0x244800, 0x006D24, 0x009100,
    0x004848, 0x000000, 0x000000, 0x000000,

    0xB6B6B6, 0x006DDA, 0x0048FF, 0x9100FF,
    0xB600FF, 0xFF0091, 0xFF0000, 0xDA6D00,
    0x916D00, 0x249100, 0x009100, 0x00B66D,
    0x009191, 0x000000, 0x000000, 0x000000,

    0xFFFFFF, 0x6DB6FF, 0x9191FF, 0xDA6DFF,
    0xFF00FF, 0xFF6DFF, 0xFF9100, 0xFFB600,
    0xDADA00, 0x6DDA00, 0x00FF00, 0x48FFDA,
    0x00FFFF, 0x000000, 0x000000, 0x000000,

    0xFFFFFF, 0xB6DAFF, 0xDAB6FF, 0xFFB6FF,
    0xFF91FF, 0xFFB6B6, 0xFFDA91, 0xFFFF48,
    0xFFFF6D, 0xB6FF48, 0x91FF6D, 0x48FFDA,
    0x91DAFF, 0x000000, 0x000000, 0x000000,
};

static u32 pal_rc2C03b[] = {
    0x6D6D6D, 0x002491, 0x0000DA, 0x6D48DA,
    0x91006D, 0xB6006D, 0xB62400, 0x914800,
    0x6D4800, 0x240000, 0x006D24, 0x009100,
    0x004848, 0x000000, 0x000000, 0x000000,

    0xB6B6B6, 0x0024DA, 0x0048FF, 0x9100FF,
    0xB600FF, 0xFF0091, 0xFF0000, 0xDA6D00,
    0x916D00, 0x249100, 0x009100, 0x00B66D,
    0x009191, 0x000000, 0x000000, 0x000000,

    0xFFFFFF, 0x6DB6FF, 0x9191FF, 0xDA6DFF,
    0xFF00FF, 0xFF24FF, 0xFF9100, 0xFFB600,
    0xDADA00, 0x6D9100, 0x00FF00, 0x48FFDA,
    0x00FFFF, 0x000000, 0x000000, 0x000000,

    0xFFFFFF, 0xB691FF, 0xDAB6FF, 0xFFB6FF,
    0xFF91FF, 0xFFB6B6, 0xFFDA91, 0xFFFF48,
    0xFFFF6D, 0xB6B648, 0x91FF6D, 0x48FFDA,
    0x91DAFF, 0x000000, 0x000000, 0x000000,
};

void Screen::output(unsigned x, unsigned y, u6 value)
{
    buf[y][x] = pal[value];
}

void Screen::set_palette(Palette palette)
{
    pal = palette == Palette::Pal2C02 ? pal2C02
        : palette == Palette::Pal2C03 ? pal2C03
                                      : palette == Palette::RC2C03B ? pal_rc2C03b
        : pal2C02;
}
